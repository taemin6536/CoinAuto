# 손절-물타기 스캘핑 전략 구현 계획

- [x] 1. 핵심 데이터 모델 및 인터페이스 구현
  - 손절-물타기 전략에 필요한 새로운 데이터 구조 생성 (Position, PositionEntry, MarketConditions, StopLossAveragingSignal, StrategyState)
  - 기존 데이터 모델과의 호환성 확보
  - 데이터 검증 및 직렬화 메서드 구현
  - _요구사항: 5.1, 5.5_

- [x] 1.1 새로운 데이터 모델에 대한 속성 테스트 작성
  - **속성 20: 동적 설정 적용**
  - **검증: 요구사항 5.3**

- [x] 1.2 데이터 모델 단위 테스트 작성
  - Position, PositionEntry, MarketConditions, StopLossAveragingSignal 검증 테스트
  - 직렬화/역직렬화 테스트
  - _요구사항: 5.1, 5.5_

- [x] 2. 시장 분석기 구현
  - MarketAnalyzer 클래스 생성
  - 24시간 변동률, 거래량 비율, RSI 계산 기능
  - 급락 감지 및 시장 트렌드 분석 기능
  - _요구사항: 8.1, 8.2, 8.3, 8.4, 8.5_

- [x] 2.1 변동성 기반 코인 선정 속성 테스트
  - **속성 32: 변동성 기반 코인 선정**
  - **검증: 요구사항 8.1**

- [x] 2.2 거래량 조건 확인 속성 테스트
  - **속성 33: 거래량 조건 확인**
  - **검증: 요구사항 8.2**

- [x] 2.3 급락 시 매수 중단 속성 테스트
  - **속성 34: 급락 시 매수 중단**
  - **검증: 요구사항 8.3**

- [x] 2.4 RSI 과매도 신뢰도 조정 속성 테스트
  - **속성 35: RSI 과매도 신뢰도 조정**
  - **검증: 요구사항 8.4**

- [x] 2.5 시장 하락 시 전략 중단 속성 테스트
  - **속성 36: 시장 하락 시 전략 중단**
  - **검증: 요구사항 8.5**

- [x] 2.6 시장 분석기 단위 테스트
  - 변동률 계산 정확성 테스트
  - RSI 계산 및 급락 감지 테스트
  - _요구사항: 8.1, 8.2, 8.3, 8.4, 8.5_

- [x] 3. 포지션 관리자 구현
  - PositionManager 클래스 생성
  - 포지션 추가, 평균 단가 계산, 부분 매도 처리
  - 포지션 상태 추적 및 손익 계산 기능
  - _요구사항: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 3.1 매수 정보 기록 속성 테스트
  - **속성 14: 매수 정보 기록**
  - **검증: 요구사항 4.1**

- [x] 3.2 평균 단가 재계산 속성 테스트
  - **속성 15: 평균 단가 재계산**
  - **검증: 요구사항 4.2**

- [x] 3.3 부분 매도 수량 업데이트 속성 테스트
  - **속성 16: 부분 매도 수량 업데이트**
  - **검증: 요구사항 4.3**

- [x] 3.4 포지션 청산 후 초기화 속성 테스트
  - **속성 17: 포지션 청산 후 초기화**
  - **검증: 요구사항 4.4**

- [x] 3.5 포지션 정보 반환 속성 테스트
  - **속성 18: 포지션 정보 반환**
  - **검증: 요구사항 4.5**

- [x] 3.6 포지션 관리자 단위 테스트
  - 평균 단가 계산 정확성 테스트
  - 부분 매도 및 포지션 초기화 테스트
  - _요구사항: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 4. 리스크 컨트롤러 구현
  - RiskController 클래스 생성
  - 일일 손실 한도, 연속 손절 제한, 계좌 잔고 확인
  - 전략 중단 조건 관리 및 주문 크기 검증
  - _요구사항: 2.3, 2.4, 2.5_

- [x] 4.1 일일 손실 한도 관리 속성 테스트
  - **속성 8: 일일 손실 한도 관리**
  - **검증: 요구사항 2.3**

- [x] 4.2 연속 손절 제한 속성 테스트
  - **속성 9: 연속 손절 제한**
  - **검증: 요구사항 2.4**

- [x] 4.3 최소 잔고 확인 속성 테스트
  - **속성 10: 최소 잔고 확인**
  - **검증: 요구사항 2.5**

- [x] 4.4 리스크 컨트롤러 단위 테스트
  - 각 리스크 관리 기능별 단위 테스트
  - 엣지 케이스 및 오류 조건 테스트
  - _요구사항: 2.3, 2.4, 2.5_

- [x] 5. 부분 매도 관리자 구현
  - PartialSellManager 클래스 생성
  - 부분 매도 조건 확인 및 매도 수량 계산
  - 매도 레벨 관리 및 다음 매도 시점 결정
  - _요구사항: 9.1, 9.2, 9.5_

- [x] 5.1 첫 번째 부분 매도 속성 테스트
  - **속성 37: 첫 번째 부분 매도**
  - **검증: 요구사항 9.1**

- [x] 5.2 두 번째 부분 매도 속성 테스트
  - **속성 38: 두 번째 부분 매도**
  - **검증: 요구사항 9.2**

- [x] 5.3 손절선 조정 속성 테스트
  - **속성 41: 손절선 조정**
  - **검증: 요구사항 9.5**

- [x] 5.4 부분 매도 관리자 단위 테스트
  - 부분 매도 조건 및 수량 계산 테스트
  - 매도 레벨 관리 테스트
  - _요구사항: 9.1, 9.2, 9.5_

- [x] 6. 트레일링 스톱 관리자 구현
  - TrailingStopManager 클래스 생성
  - 트레일링 스톱 활성화 조건 및 최고가 추적
  - 트레일링 스톱 실행 조건 확인
  - _요구사항: 9.3, 9.4_

- [x] 6.1 트레일링 스톱 활성화 속성 테스트
  - **속성 39: 트레일링 스톱 활성화**
  - **검증: 요구사항 9.3**

- [x] 6.2 트레일링 스톱 실행 속성 테스트
  - **속성 40: 트레일링 스톱 실행**
  - **검증: 요구사항 9.4**

- [x] 6.3 트레일링 스톱 관리자 단위 테스트
  - 트레일링 스톱 활성화 및 실행 테스트
  - 최고가 추적 및 스톱 가격 계산 테스트
  - _요구사항: 9.3, 9.4_

- [x] 7. 메인 전략 클래스 구현
  - StopLossAveragingStrategy 클래스 생성 (TradingStrategy 상속)
  - 진입 조건 확인 및 신호 생성 로직
  - 물타기, 손절, 수익 실현 조건 처리
  - _요구사항: 1.1, 1.2, 1.3, 1.4, 1.5, 2.1, 2.2_

- [x] 7.1 물타기 매수 실행 속성 테스트
  - **속성 1: 물타기 매수 실행**
  - **검증: 요구사항 1.1**

- [x] 7.2 손절 매도 실행 속성 테스트
  - **속성 2: 손절 매도 실행**
  - **검증: 요구사항 1.2**

- [x] 7.3 손익분기점 매도 속성 테스트
  - **속성 3: 손익분기점 매도**
  - **검증: 요구사항 1.3**

- [x] 7.4 물타기 후 추가 매수 제한 속성 테스트
  - **속성 4: 물타기 후 추가 매수 제한**
  - **검증: 요구사항 1.4**

- [x] 7.5 매도 후 상태 초기화 속성 테스트
  - **속성 5: 매도 후 상태 초기화**
  - **검증: 요구사항 1.5**

- [x] 7.6 수수료 포함 손익 계산 속성 테스트
  - **속성 6: 수수료 포함 손익 계산**
  - **검증: 요구사항 2.1**

- [x] 7.7 양방향 수수료 반영 속성 테스트
  - **속성 7: 양방향 수수료 반영**
  - **검증: 요구사항 2.2**

- [x] 7.8 메인 전략 단위 테스트
  - 신호 생성 로직 테스트
  - 진입 조건 확인 테스트
  - _요구사항: 1.1, 1.2, 1.3, 1.4, 1.5, 2.1, 2.2_

- [ ] 8. 시장 모니터링 및 주문 실행 시스템
  - 짧은 주기 시장 모니터링 구현
  - 네트워크 오류 재시도 및 API 한도 관리
  - 주문 실행 및 오류 처리
  - _요구사항: 3.1, 3.3, 3.4, 3.5_

- [ ] 8.1 매수/매도 조건 충족 시 주문 실행 속성 테스트
  - **속성 11: 매수/매도 조건 충족 시 주문 실행**
  - **검증: 요구사항 3.3**

- [ ] 8.2 네트워크 오류 재시도 속성 테스트
  - **속성 12: 네트워크 오류 재시도**
  - **검증: 요구사항 3.4**

- [ ] 8.3 API 한도 관리 속성 테스트
  - **속성 13: API 한도 관리**
  - **검증: 요구사항 3.5**

- [ ] 8.4 시장 모니터링 단위 테스트
  - 모니터링 주기 및 주문 실행 테스트
  - 오류 처리 및 재시도 로직 테스트
  - _요구사항: 3.1, 3.3, 3.4, 3.5_

- [ ] 9. 전략 통합 및 상태 관리
  - 기존 전략 시스템과의 통합
  - 전략 독립성 보장 및 상태 저장/복원
  - 동적 설정 적용 및 전략 중단/재시작
  - _요구사항: 5.2, 5.3, 5.4, 5.5_

- [ ] 9.1 전략 독립성 속성 테스트
  - **속성 19: 전략 독립성**
  - **검증: 요구사항 5.2**

- [ ] 9.2 포지션 상태 저장 속성 테스트
  - **속성 21: 포지션 상태 저장**
  - **검증: 요구사항 5.4**

- [ ] 9.3 포지션 상태 복원 속성 테스트
  - **속성 22: 포지션 상태 복원**
  - **검증: 요구사항 5.5**

- [ ] 9.4 전략 통합 단위 테스트
  - 다중 전략 실행 테스트
  - 상태 저장/복원 메커니즘 테스트
  - _요구사항: 5.2, 5.3, 5.4, 5.5_

- [ ] 10. 설정 관리 및 파라미터 검증
  - 전략 파라미터 범위 검증 시스템
  - 동적 설정 변경 및 핫 리로드 지원
  - 설정 유효성 검증 및 기본값 처리
  - _요구사항: 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 10.1 손절 수준 범위 검증 속성 테스트
  - **속성 27: 손절 수준 범위 검증**
  - **검증: 요구사항 7.1**

- [ ] 10.2 물타기 트리거 범위 검증 속성 테스트
  - **속성 28: 물타기 트리거 범위 검증**
  - **검증: 요구사항 7.2**

- [ ] 10.3 목표 수익률 범위 검증 속성 테스트
  - **속성 29: 목표 수익률 범위 검증**
  - **검증: 요구사항 7.3**

- [ ] 10.4 모니터링 주기 범위 검증 속성 테스트
  - **속성 30: 모니터링 주기 범위 검증**
  - **검증: 요구사항 7.4**

- [ ] 10.5 물타기 횟수 제한 속성 테스트
  - **속성 31: 물타기 횟수 제한**
  - **검증: 요구사항 7.5**

- [ ] 10.6 설정 관리 단위 테스트
  - 파라미터 범위 검증 테스트
  - 동적 설정 변경 테스트
  - _요구사항: 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 11. 로깅 및 데이터 저장 시스템
  - 거래 신호 생성 및 주문 실행 로깅
  - 포지션 변경 기록 및 오류 정보 저장
  - 성과 보고서 생성 및 데이터베이스 연동
  - _요구사항: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 11.1 매수 주문 로깅 속성 테스트
  - **속성 23: 매수 주문 로깅**
  - **검증: 요구사항 6.1**

- [ ] 11.2 매도 주문 기록 속성 테스트
  - **속성 24: 매도 주문 기록**
  - **검증: 요구사항 6.2**

- [ ] 11.3 포지션 변경 저장 속성 테스트
  - **속성 25: 포지션 변경 저장**
  - **검증: 요구사항 6.3**

- [ ] 11.4 오류 정보 로깅 속성 테스트
  - **속성 26: 오류 정보 로깅**
  - **검증: 요구사항 6.5**

- [ ] 11.5 로깅 시스템 단위 테스트
  - 로그 생성 및 저장 테스트
  - 성과 보고서 생성 테스트
  - _요구사항: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 12. 첫 번째 체크포인트 - 모든 테스트 통과 확인
  - 모든 테스트가 통과하는지 확인하고, 문제가 있으면 사용자에게 질문

- [ ] 13. 전략 설정 파일 및 문서 작성
  - config/strategies/stop_loss_averaging.yaml 파일 생성
  - 전략 사용법 문서 작성 (docs/strategies/stop_loss_averaging.md)
  - 예제 설정 및 사용 가이드
  - _요구사항: 모든 요구사항_

- [ ] 13.1 설정 파일 검증 단위 테스트
  - YAML 파일 구조 검증
  - 기본값 및 범위 검증
  - _요구사항: 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 14. 통합 테스트 및 시스템 검증
  - 전체 시스템 통합 테스트
  - 실제 시장 데이터를 사용한 백테스팅
  - 성능 및 메모리 사용량 검증
  - _요구사항: 모든 요구사항_

- [ ] 14.1 통합 테스트 작성
  - 전체 손절-물타기 전략 워크플로우 테스트
  - 다른 전략과의 상호작용 테스트
  - _요구사항: 모든 요구사항_

- [ ] 15. 최종 체크포인트 - 모든 테스트 통과 확인
  - 모든 테스트가 통과하는지 확인하고, 문제가 있으면 사용자에게 질문